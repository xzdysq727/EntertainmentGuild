@model List<EntertainmentGuild.Models.Product>
@{
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
    ViewData["Title"] = "Search Results";
    var keyword = ViewBag.Keyword as string ?? "";
}

<div class="container mt-5 mb-5">
   
    <form asp-action="Search" method="get" class="position-relative mb-4">
        <input type="text"
               name="keyword"
               id="searchInput"
               class="form-control rounded-pill px-4 py-2 shadow-sm"
               placeholder="Search item or brand..."
               value="@keyword"
               autocomplete="off"
               style="border: 1px solid #ccc;" />

        <div id="suggestionPopup"
             class="bg-white border rounded shadow-sm position-absolute w-100 mt-1"
             style="display: none; z-index: 2000;">
            <ul id="suggestionList" class="list-unstyled mb-0 p-2"></ul>
        </div>
    </form>

    <h5>Search Results for "<strong>@keyword</strong>"</h5>

    @if (!Model.Any())
    {
        <p class="text-muted">No products found.</p>
    }
    else
    {
        <div class="row mt-4">
            @foreach (var product in Model)
            {
                <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                    <div class="card h-100 border-0 shadow-sm rounded-3 product-card">
                        @if (product.ImageData != null)
                        {
                            <img src="data:image/png;base64,@Convert.ToBase64String(product.ImageData)"
                                 class="card-img-top rounded-top"
                                 style="height: 200px; object-fit: cover;" />
                        }
                        else
                        {
                            <div class="d-flex justify-content-center align-items-center text-muted"
                                 style="height: 200px; background: #f8f8f8; border-top-left-radius: 0.5rem; border-top-right-radius: 0.5rem;">
                                <i class="bi bi-image-alt" style="font-size: 2rem;"></i>
                            </div>
                        }

                        <div class="card-body d-flex flex-column">
                            <h6 class="card-title text-truncate">@product.Name</h6>
                            <p class="text-muted small mb-2">@product.Category > @product.SubCategory</p>
                            <p class="fw-bold mt-auto" style="color: #b29b4b;">¥@product.Price.ToString("F2")</p>
                            <a href="@Url.Action("ProductDetails", "Customer", new { id = product.Id })"
                               class="btn btn-gold btn-sm mt-2 w-100">
                                View Details
                            </a>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>


@section Scripts {
    <script>
        const searchInput = document.getElementById("searchInput");
        const popup = document.getElementById("suggestionPopup");
        const list = document.getElementById("suggestionList");

        searchInput.addEventListener("focus", async () => {
            try {
                const res = await fetch("/Customer/GetRandomProducts");
                const data = await res.json();

                list.innerHTML = "";
                data.forEach(name => {
                    const li = document.createElement("li");
                    li.innerHTML = `<a href="/Customer/Search?keyword=${encodeURIComponent(name)}"
                                        class="d-block py-2 px-3 rounded text-decoration-none text-dark hover-bg">
                                        🔎 ${name}</a>`;
                    list.appendChild(li);
                });

                popup.style.display = "block";
            } catch (err) {
                console.error("Suggestion fetch error", err);
            }
        });

        document.addEventListener("click", function (e) {
            if (!searchInput.contains(e.target) && !popup.contains(e.target)) {
                popup.style.display = "none";
            }
        });
    </script>
    <style>
        .hover-bg:hover {
            background-color: #f0f0f0;
        }

        .btn-gold {
            background-color: #b29b4b;
            color: white;
            border: none;
            border-radius: 50px;
            transition: 0.3s ease;
        }

            .btn-gold:hover {
                background-color: #a08935;
                color: white;
            }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
    </style>
}


<footer class="mt-5 pt-4 pb-3 bg-light text-dark border-top shadow-sm">
    <div class="container">
        <div class="row">
            <div class="col-md-4 mb-3">
                <h5 class="fw-bold" style="color:#b29b4b;">e-Closet</h5>
                <p class="text-muted small">
                    Your curated fashion corner.
                    Blending style & soul with a touch of music.
                </p>
            </div>

            <div class="col-md-4 mb-3">
                <h6 class="fw-bold">Quick Links</h6>
                <ul class="list-unstyled small">
                    <li><a href="/Customer/Index" class="text-decoration-none text-dark">Home</a></li>
                    <li><a href="/Customer/Product" class="text-decoration-none text-dark">Products</a></li>
                    <li><a href="/Customer/Cart" class="text-decoration-none text-dark">Cart</a></li>
                    <li><a href="/Customer/Account" class="text-decoration-none text-dark">My Account</a></li>
                </ul>
            </div>

            <div class="col-md-4 mb-3">
                <h6 class="fw-bold">Contact</h6>
                <p class="small mb-1"><i class="bi bi-envelope me-1"></i> support@ecloset.com</p>
                <p class="small">
                    <i class="bi bi-music-note-beamed me-1"></i> Follow us on
                    <a href="#" class="text-decoration-none text-dark">Instagram</a>
                </p>
            </div>
        </div>

        <div class="text-center mt-4 border-top pt-3 small text-muted">
            © @DateTime.Now.Year e-Closet. All rights reserved.
        </div>
    </div>
</footer>
